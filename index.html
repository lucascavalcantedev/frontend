<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Eclesial - Gestão</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 60px;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        .login-logo h1 {
            color: var(--primary);
            font-size: 28px;
        }

        .input-group {
            position: relative;
            margin-bottom: 25px;
        }

        .input-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            z-index: 1;
        }

        .input-group input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--secondary);
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--gray);
            font-size: 14px;
        }

        /* Sistema */
        .system-container {
            display: none;
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            height: 90vh;
        }

        .app-header {
            background: var(--primary);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h2 {
            font-size: 22px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-body {
            display: flex;
            height: calc(100% - 80px);
        }

        .sidebar {
            width: var(--sidebar-width);
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: white;
            border-left-color: var(--secondary);
            color: var(--secondary);
        }

        .nav-item i {
            width: 20px;
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f5f7fa;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .card-icon.entradas { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-icon.dizimos { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .card-icon.ofertas { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card-icon.despesas { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .card-icon.membros { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .card-icon.pendentes { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }

        .card-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
        }

        .card-label {
            color: var(--gray);
            font-size: 14px;
            margin-top: 5px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-top: 20px;
        }

        /* Tabelas */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Formulários */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .app-body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }
            
            .nav-item {
                flex-direction: column;
                padding: 10px;
                font-size: 12px;
                text-align: center;
                min-width: 80px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="login-container" id="loginContainer">
        <div class="login-logo">
            <i class="fas fa-church"></i>
            <h1>Sistema Eclesial</h1>
            <p>Gestão Financeira e de Membros</p>
        </div>
        
        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="username" placeholder="Usuário" value="admin">
        </div>
        
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="Senha" value="admin123">
        </div>
        
        <button class="login-btn" onclick="login()">
            <i class="fas fa-sign-in-alt"></i> Entrar
        </button>
        
        <div class="login-footer">
            <p>Sistema de gestão eclesial v1.0</p>
        </div>
    </div>

    <!-- Sistema Principal -->
    <div class="system-container" id="systemContainer">
        <div class="app-header">
            <div class="header-left">
                <h2><i class="fas fa-church"></i> Sistema Eclesial</h2>
            </div>
            <div class="header-right">
                <div class="user-menu" onclick="logout()">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <span id="usernameDisplay">Administrador</span>
                </div>
            </div>
        </div>
        
        <div class="app-body">
            <div class="sidebar">
                <div class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showSection('membros')">
                    <i class="fas fa-users"></i>
                    <span>Membros</span>
                </div>
                <div class="nav-item" onclick="showSection('financeiro')">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Financeiro</span>
                </div>
                <div class="nav-item" onclick="showSection('transacoes')">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transações PIX</span>
                </div>
                <div class="nav-item" onclick="showSection('despesas')">
                    <i class="fas fa-receipt"></i>
                    <span>Despesas</span>
                </div>
                <div class="nav-item" onclick="showSection('relatorios')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </div>
            </div>
            
            <div class="content" id="content">
                <!-- Conteúdo será carregado aqui -->
            </div>
        </div>
    </div>

    <!-- Modal para adicionar/editar membro -->
    <div class="modal" id="membroModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Novo Membro</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nome Completo *</label>
                        <input type="text" id="membroNome" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Nascimento</label>
                        <input type="date" id="membroNascimento" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Telefone</label>
                        <input type="tel" id="membroTelefone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="membroEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Endereço</label>
                        <input type="text" id="membroEndereco" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label>Observações</label>
                    <textarea id="membroObservacoes" class="form-control" rows="3"></textarea>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                    <button class="btn btn-success" onclick="saveMembro()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURAÇÃO - EDITAR ESTES VALORES
        const API_URL = 'https://sistema-eclesial-backend.onrender.com'; // URL do seu backend no Render
        const API_KEY = 'sb_secret_QCFJFgHUuQqj4HQPKp1paA_pyeEAiti'; // Mesma chave do backend
        let authToken = '';
        let currentMembroId = null;

        // Elementos DOM
        const loginContainer = document.getElementById('loginContainer');
        const systemContainer = document.getElementById('systemContainer');
        const content = document.getElementById('content');

        // Funções de Login
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password})
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('token', authToken);
                    loginContainer.style.display = 'none';
                    systemContainer.style.display = 'block';
                    showSection('dashboard');
                } else {
                    alert(data.error || 'Erro no login');
                }
            } catch (error) {
                alert('Erro de conexão');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            loginContainer.style.display = 'block';
            systemContainer.style.display = 'none';
        }

        // Verificar login ao carregar
        window.onload = function() {
            const token = localStorage.getItem('token');
            if (token) {
                authToken = token;
                loginContainer.style.display = 'none';
                systemContainer.style.display = 'block';
                showSection('dashboard');
            }
        };

        // Navegação entre seções
        function showSection(section) {
            // Ativar item do menu
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Carregar conteúdo
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'membros':
                    loadMembros();
                    break;
                case 'financeiro':
                    loadFinanceiro();
                    break;
                case 'transacoes':
                    loadTransacoes();
                    break;
                case 'despesas':
                    loadDespesas();
                    break;
                case 'relatorios':
                    loadRelatorios();
                    break;
            }
        }

        // ========== DASHBOARD ==========
        async function loadDashboard() {
            content.innerHTML = '<div class="loading"></div> Carregando dashboard...';
            
            try {
                const response = await fetch(`${API_URL}/api/dashboard`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                const data = await response.json();
                
                content.innerHTML = `
                    <h1><i class="fas fa-home"></i> Dashboard</h1>
                    <p>Visão geral do sistema</p>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3>Entradas do Mês</h3>
                                <div class="card-icon entradas">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="card-value">R$ ${data.total_entradas?.toFixed(2) || '0.00'}</div>
                            <div class="card-label">Total recebido este mês</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3>Dízimos</h3>
                                <div class="card-icon dizimos">
                                    <i class="fas fa-hand-holding-usd"></i>
                                </div>
                            </div>
                            <div class="card-value">R$ ${data.dizimos?.toFixed(2) || '0.00'}</div>
                            <div class="card-label">Total em dízimos</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3>Ofertas</h3>
                                <div class="card-icon ofertas">
                                    <i class="fas fa-gift"></i>
                                </div>
                            </div>
                            <div class="card-value">R$ ${data.ofertas?.toFixed(2) || '0.00'}</div>
                            <div class="card-label">Total em ofertas</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3>Despesas</h3>
                                <div class="card-icon despesas">
                                    <i class="fas fa-receipt"></i>
                                </div>
                            </div>
                            <div class="card-value">R$ ${data.total_despesas?.toFixed(2) || '0.00'}</div>
                            <div class="card-label">Total gasto este mês</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3>Membros</h3>
                                <div class="card-icon membros">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="card-value">${data.total_membros || 0}</div>
                            <div class="card-label">Total de membros cadastrados</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3>Pendentes</h3>
                                <div class="card-icon pendentes">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="card-value">${data.transacoes_pendentes || 0}</div>
                            <div class="card-label">Transações para validar</div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Resumo Financeiro Mensal</h3>
                        <div style="height: 300px; display: flex; align-items: flex-end; gap: 20px; margin-top: 20px;">
                            <div style="flex: 1; text-align: center;">
                                <div style="background: #667eea; height: ${(data.dizimos/data.total_entradas*200) || 0}px; border-radius: 10px 10px 0 0;"></div>
                                <div style="margin-top: 10px;">Dízimos</div>
                            </div>
                            <div style="flex: 1; text-align: center;">
                                <div style="background: #4facfe; height: ${(data.ofertas/data.total_entradas*200) || 0}px; border-radius: 10px 10px 0 0;"></div>
                                <div style="margin-top: 10px;">Ofertas</div>
                            </div>
                            <div style="flex: 1; text-align: center;">
                                <div style="background: #43e97b; height: ${(data.total_despesas/data.total_entradas*200) || 0}px; border-radius: 10px 10px 0 0;"></div>
                                <div style="margin-top: 10px;">Despesas</div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<div class="alert">Erro ao carregar dashboard: ${error}</div>`;
            }
        }

        // ========== MEMBROS ==========
        async function loadMembros() {
            content.innerHTML = '<div class="loading"></div> Carregando membros...';
            
            try {
                const response = await fetch(`${API_URL}/api/membros`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                const membros = await response.json();
                
                let tableRows = '';
                membros.forEach(membro => {
                    tableRows += `
                        <tr>
                            <td>${membro.codigo}</td>
                            <td>${membro.nome_completo}</td>
                            <td>${membro.data_nascimento ? new Date(membro.data_nascimento).toLocaleDateString('pt-BR') : ''}</td>
                            <td>${membro.telefone || ''}</td>
                            <td>${new Date(membro.data_cadastro).toLocaleDateString('pt-BR')}</td>
                            <td>
                                <button class="btn btn-primary" onclick="editMembro('${membro.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteMembro('${membro.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                content.innerHTML = `
                    <h1><i class="fas fa-users"></i> Gerenciamento de Membros</h1>
                    <div style="display: flex; justify-content: space-between; margin: 20px 0;">
                        <button class="btn btn-success" onclick="openMembroModal()">
                            <i class="fas fa-plus"></i> Novo Membro
                        </button>
                        <button class="btn btn-primary" onclick="exportMembrosExcel()">
                            <i class="fas fa-file-excel"></i> Exportar para Excel
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Nome Completo</th>
                                    <th>Data Nasc.</th>
                                    <th>Telefone</th>
                                    <th>Data Cadastro</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<div class="alert">Erro ao carregar membros: ${error}</div>`;
            }
        }

        // Funções membros
        function openMembroModal(editId = null) {
            currentMembroId = editId;
            document.getElementById('modalTitle').textContent = editId ? 'Editar Membro' : 'Novo Membro';
            document.getElementById('membroModal').style.display = 'flex';
            
            if (editId) {
                // Carregar dados do membro
                fetch(`${API_URL}/api/membros/${editId}`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                })
                .then(response => response.json())
                .then(membro => {
                    document.getElementById('membroNome').value = membro.nome_completo || '';
                    document.getElementById('membroNascimento').value = membro.data_nascimento || '';
                    document.getElementById('membroTelefone').value = membro.telefone || '';
                    document.getElementById('membroEmail').value = membro.email || '';
                    document.getElementById('membroEndereco').value = membro.endereco || '';
                    document.getElementById('membroObservacoes').value = membro.observacoes || '';
                });
            } else {
                // Limpar formulário
                document.getElementById('membroNome').value = '';
                document.getElementById('membroNascimento').value = '';
                document.getElementById('membroTelefone').value = '';
                document.getElementById('membroEmail').value = '';
                document.getElementById('membroEndereco').value = '';
                document.getElementById('membroObservacoes').value = '';
            }
        }

        async function saveMembro() {
            const membroData = {
                nome_completo: document.getElementById('membroNome').value,
                data_nascimento: document.getElementById('membroNascimento').value,
                telefone: document.getElementById('membroTelefone').value,
                email: document.getElementById('membroEmail').value,
                endereco: document.getElementById('membroEndereco').value,
                observacoes: document.getElementById('membroObservacoes').value
            };
            
            try {
                if (currentMembroId) {
                    // Atualizar
                    await fetch(`${API_URL}/api/membros/${currentMembroId}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(membroData)
                    });
                } else {
                    // Criar novo
                    await fetch(`${API_URL}/api/membros`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(membroData)
                    });
                }
                
                closeModal();
                loadMembros();
            } catch (error) {
                alert('Erro ao salvar membro: ' + error);
            }
        }

        async function deleteMembro(id) {
            if (confirm('Tem certeza que deseja excluir este membro?')) {
                try {
                    await fetch(`${API_URL}/api/membros/${id}`, {
                        method: 'DELETE',
                        headers: {'Authorization': `Bearer ${authToken}`}
                    });
                    loadMembros();
                } catch (error) {
                    alert('Erro ao excluir membro: ' + error);
                }
            }
        }

        function editMembro(id) {
            openMembroModal(id);
        }

        async function exportMembrosExcel() {
    try {
        const response = await fetch(`${API_URL}/api/membros/exportar-csv`, {
            headers: {'Authorization': `Bearer ${authToken}`}
        });
        
        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `membros_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        } else {
            const error = await response.json();
            alert('Erro ao exportar: ' + error.error);
        }
    } catch (error) {
        alert('Erro ao exportar: ' + error);
    }

    async function gerarRelatorioDespesas() {
    const mesAno = document.getElementById('mesDespesas').value;
    const [ano, mes] = mesAno.split('-');
    
    window.open(`${API_URL}/api/relatorios/despesas?mes=${mes}&ano=${ano}`, '_blank');
}
}

        // ========== TRANSAÇÕES PIX ==========
        async function loadTransacoes() {
            content.innerHTML = '<div class="loading"></div> Carregando transações...';
            
            try {
                const response = await fetch(`${API_URL}/api/transacoes`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                const transacoes = await response.json();
                
                let tableRows = '';
                transacoes.forEach(trans => {
                    const statusBadge = trans.status === 'pendente' 
                        ? '<span style="background: #f39c12; color: white; padding: 5px 10px; border-radius: 20px;">Pendente</span>'
                        : '<span style="background: #27ae60; color: white; padding: 5px 10px; border-radius: 20px;">Confirmada</span>';
                    
                    const acoes = trans.status === 'pendente' 
                        ? `
                            <button class="btn btn-success" onclick="confirmarTransacao('${trans.id}', 'dizimo')">
                                <i class="fas fa-church"></i> Dízimo
                            </button>
                            <button class="btn btn-warning" onclick="confirmarTransacao('${trans.id}', 'oferta')">
                                <i class="fas fa-gift"></i> Oferta
                            </button>
                        `
                        : `<span>${trans.tipo}</span>`;
                    
                    tableRows += `
                        <tr>
                            <td>${trans.membros?.nome_completo || trans.nome_pagador}</td>
                            <td>${trans.membros?.codigo || 'Não vinculado'}</td>
                            <td>R$ ${parseFloat(trans.valor).toFixed(2)}</td>
                            <td>${new Date(trans.data).toLocaleString('pt-BR')}</td>
                            <td>${statusBadge}</td>
                            <td>${acoes}</td>
                        </tr>
                    `;
                });
                
                content.innerHTML = `
                    <h1><i class="fas fa-exchange-alt"></i> Transações PIX</h1>
                    <p>Validação de transações recebidas via PIX</p>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Código</th>
                                    <th>Valor</th>
                                    <th>Data</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <h4><i class="fas fa-info-circle"></i> Instruções:</h4>
                        <p>1. O sistema tenta vincular automaticamente pelo nome</p>
                        <p>2. Clique em "Dízimo" ou "Oferta" para confirmar a transação</p>
                        <p>3. Transações confirmadas geram entrada automática no financeiro</p>
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<div class="alert">Erro ao carregar transações: ${error}</div>`;
            }
        }

        async function confirmarTransacao(id, tipo) {
            try {
                await fetch(`${API_URL}/api/transacoes/${id}/confirmar`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({tipo})
                });
                alert('Transação confirmada!');
                loadTransacoes();
            } catch (error) {
                alert('Erro ao confirmar transação: ' + error);
            }
        }

        // ========== DESPESAS ==========
        async function loadDespesas() {
            content.innerHTML = '<div class="loading"></div> Carregando despesas...';
            // Implementação similar às outras seções
        }

        // ========== RELATÓRIOS ==========
        function loadRelatorios() {
            const hoje = new Date();
            const mesAtual = String(hoje.getMonth() + 1).padStart(2, '0');
            const anoAtual = hoje.getFullYear();
            
            content.innerHTML = `
                <h1><i class="fas fa-chart-bar"></i> Relatórios</h1>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>Relatório de Entradas</h3>
                        <p>Gere relatório PDF de entradas (sem nomes)</p>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Mês/Ano:</label>
                            <input type="month" id="mesEntradas" value="${anoAtual}-${mesAtual}" class="form-control">
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;" onclick="gerarRelatorioEntradas()">
                            <i class="fas fa-file-pdf"></i> Gerar PDF
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3>Relatório de Despesas</h3>
                        <p>Gere relatório PDF de despesas</p>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Mês/Ano:</label>
                            <input type="month" id="mesDespesas" value="${anoAtual}-${mesAtual}" class="form-control">
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;" onclick="gerarRelatorioDespesas()">
                            <i class="fas fa-file-pdf"></i> Gerar PDF
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3>Relatório Final Mensal</h3>
                        <p>Relatório completo com saldo</p>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Mês/Ano:</label>
                            <input type="month" id="mesFinal" value="${anoAtual}-${mesAtual}" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Saldo Anterior (R$):</label>
                            <input type="number" id="saldoAnterior" step="0.01" class="form-control">
                        </div>
                        <button class="btn btn-success" style="margin-top: 10px;" onclick="gerarRelatorioFinal()">
                            <i class="fas fa-file-invoice-dollar"></i> Gerar Relatório
                        </button>
                    </div>
                </div>
            `;
        }

        async function gerarRelatorioEntradas() {
            const mesAno = document.getElementById('mesEntradas').value;
            const [ano, mes] = mesAno.split('-');
            
            window.open(`${API_URL}/api/relatorios/entradas?mes=${mes}&ano=${ano}`, '_blank');
        }

        async function gerarRelatorioFinal() {
            const mesAno = document.getElementById('mesFinal').value;
            const saldoAnterior = document.getElementById('saldoAnterior').value || 0;
            const [ano, mes] = mesAno.split('-');
            
            window.open(`${API_URL}/api/relatorios/final-mensal?mes=${mes}&ano=${ano}&saldo_anterior=${saldoAnterior}`, '_blank');
        }

        // Funções auxiliares
        function closeModal() {
            document.getElementById('membroModal').style.display = 'none';
            currentMembroId = null;
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('membroModal');
            if (event.target === modal) {
                closeModal();
            }
        };

        // Configurar tecla Enter no login
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });
    </script>
</body>
</html>